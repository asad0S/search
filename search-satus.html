<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø±Ø³ÛŒØ¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÙˆÛŒØ²Ø§</title>

<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;800&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Vazirmatn', Tahoma, sans-serif;
  background:#e6f2ff;
  margin:0;
  padding:0;
  color:#333;
}
.container{
  width:95%;
  max-width:750px;
  margin:2rem auto;
  padding:1rem;
}
.page-title{
  text-align:center;
  color:#1a5f7a;
  margin-bottom:1.5rem;
  font-size:1.9rem;
}

input, button{
  width:100%;
  padding:0.8rem;
  margin-bottom:1rem;
  font-size:1.1rem;
  border-radius:8px;
}
input{border:1px solid #ccc;}
button{
  background:#1a5f7a;
  color:white;
  border:none;
  cursor:pointer;
  font-weight:bold;
}
button:hover{background:#154b61;}

.result{
  display:none;
  background:white;
  padding:1.8rem;
  border-radius:10px;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
  margin-bottom:10px;
}

/* Ø³Ø±Ø¨Ø±Ú¯ Ø±Ø³Ù…ÛŒ */
.header{
  text-align:center;
  border-bottom:3px double #1a5f7a;
  padding-bottom:1.2rem;
  margin-bottom:1.5rem;
}
.header h1{
  margin:0;
  font-size:2rem;
  font-weight:800;
  color:#0f3f52;
}
.header p{
  margin:5px 0;
  font-size:1rem;
  font-weight:500;
}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª */
table{
  width:100%;
  border-collapse:collapse;
  font-size:1.05rem;
}
th, td{
  border:1px solid #999;
  padding:8px;
}
th{
  background:#1a5f7a;
  color:white;
}
td.label{
  width:35%;
  font-weight:600;
  color:#1a5f7a;
}

/* Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ù†Øª */
.print-btn{
  margin-top:1.5rem;
  background:#2e8b57;
}
.print-btn:hover{background:#256f46;}

.alert{
  color:red;
  text-align:center;
  font-weight:bold;
}

/* ===================== */
/*        PRINT          */
/* ===================== */
@media print{

  @page{
    size: A4 landscape;   /* ğŸ‘ˆ A4 Ø§ÙÙ‚ÛŒ */
    margin: 10mm;
  }

  body{
    background:white;
  }

  input, button, .page-title{
    display:none;
  }

  .container{
    width:100%;
    margin:0;
    padding:0;
  }

  /* Ù‡Ø± Ø±Ø³ÛŒØ¯ */
  .result{
    display:inline-block;
    width:48%;           /* Ø¯Ùˆ Ø³ØªÙˆÙ† */
    height:auto;
    vertical-align:top;
    margin:1%;
    page-break-inside:avoid;

    border:1px dashed #555;   /* Ø®Ø· Ø¨Ø±Ø´ */
    padding:12px;
    box-shadow:none;
    border-radius:6px;
  }

  table{
    font-size:0.95rem;
  }

  .header h1{
    font-size:1.4rem;
  }

  .header p{
    font-size:0.85rem;
  }
}
</style>
</head>

<body>
<div class="container">

  <h2 class="page-title">Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÙˆÛŒØ²Ø§</h2>

  <input type="text" id="otpInput" placeholder="Ú©Ø¯ Ø®ÙˆØ¯Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
  <button id="checkBtn">Ú†ÛŒÚ© Ú©Ø±Ø¯Ù† ÙˆØ¶ÛŒØ¹Øª</button>

  <div class="result" id="resultDiv">

    <div class="header">
      <h1>Ø®Ø¯Ù…Ø§Øª Ú©Ù…Ù¾ÛŒÙˆØªØ±ÛŒ Ø³Ø±Ø§ÙØ±Ø§Ø²ÛŒ</h1>
      <p>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³: 0705927368 ØŒ 0799846656 ØŒ 0778743678</p>
      <p>Ø¢Ø¯Ø±Ø³: ÙØ§Ø±ÛŒØ§Ø¨ â€“ Ø´Ù‡Ø± Ù…ÛŒÙ…Ù†Ù‡</p>
    </div>

    <table id="infoTable"></table>

    <!-- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† id Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ù†Øª -->
    <button id="printButton" class="print-btn" onclick="window.print()">Ù¾Ø±Ù†Øª Ø±Ø³ÛŒØ¯</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCHjDCV5G4SqXBVayBSQKu0w7ahl-iKK9s",
  authDomain: "search-system-d27b7.firebaseapp.com",
  projectId: "search-system-d27b7",
  storageBucket: "search-system-d27b7.firebasestorage.app",
  messagingSenderId: "928320892642",
  appId: "1:928320892642:web:56263d08783990405738bb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const otpInput = document.getElementById('otpInput');
const checkBtn = document.getElementById('checkBtn');
const resultDiv = document.getElementById('resultDiv');
const infoTable = document.getElementById('infoTable');
const printButton = document.getElementById('printButton'); // Ú¯Ø±ÙØªÙ† Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ù†Øª

checkBtn.addEventListener('click', async ()=>{
  const otp = otpInput.value.trim();
  if(!otp){
    alert('Ú©Ø¯ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
    return;
  }

  const q = query(collection(db,"visaRequests"), where("otp","==",Number(otp)));
  const snapshot = await getDocs(q);

  resultDiv.style.display = 'block';

  if(snapshot.empty){
    infoTable.innerHTML = `<tr><td class="alert">Ú¯Ø´ØªÙ… Ù†Ø¨ÙˆØ¯ØŒ Ù†Ú¯Ø±Ø¯ Ù†ÛŒØ³Øª</td></tr>`;
    printButton.style.display = 'none'; // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ù†Øª
    return;
  }

  // Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ù†Øª Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø¯Ø§Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ø´Ø¯
  printButton.style.display = 'block';

  snapshot.forEach(docSnap=>{
    const d = docSnap.data();
    infoTable.innerHTML = `
      <tr><th>Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ø·Ù„Ø§Ø¹Ø§Øª</th></tr>
      <tr><td class="label">Ø§Ø³Ù… Ú©Ø§Ù…Ù„</td><td>${d.fullName}</td></tr>
      <tr><td class="label">Ø§Ø³Ù… Ù¾Ø¯Ø±</td><td>${d.fatherName}</td></tr>
      <tr><td class="label">Ù†ÙˆØ¹ ÙˆÛŒØ²Ø§</td><td>${d.visaType}</td></tr>
      <tr><td class="label">ÙˆØ¶Ø¹ÛŒØª</td><td>${d.status}</td></tr>
      <tr><td class="label">Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</td><td>${d.amount} Ø§ÙØºØ§Ù†ÛŒ</td></tr>
      <tr><td class="label">Ø±Ø³ÛŒØ¯</td><td>${d.receipt} Ø§ÙØºØ§Ù†ÛŒ</td></tr>
      <tr><td class="label">Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡</td><td>${d.remaining} Ø§ÙØºØ§Ù†ÛŒ</td></tr>
      <tr><td class="label">ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„ Ù¾Ø§Ø³Ù¾ÙˆØ±Øª</td><td>${d.deliveryDate}</td></tr>
      <tr><td class="label">Ú©Ø¯ Ø´Ù…Ø§</td><td>${d.otp}</td></tr>
    `;
  });
});
</script>
</body>
</html>
