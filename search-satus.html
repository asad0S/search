<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>رسید درخواست ویزا</title>

<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;800&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Vazirmatn', Tahoma, sans-serif;
  background:#e6f2ff;
  margin:0;
  padding:0;
  color:#333;
}
.container{
  width:95%;
  max-width:750px;
  margin:2rem auto;
  padding:1rem;
}
.page-title{
  text-align:center;
  color:#1a5f7a;
  margin-bottom:1.5rem;
  font-size:1.9rem;
}

input, button{
  width:100%;
  padding:0.8rem;
  margin-bottom:1rem;
  font-size:1.1rem;
  border-radius:8px;
}
input{border:1px solid #ccc;}
button{
  background:#1a5f7a;
  color:white;
  border:none;
  cursor:pointer;
  font-weight:bold;
}
button:hover{background:#154b61;}

.result{
  display:none;
  background:white;
  padding:1.8rem;
  border-radius:10px;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
  margin-bottom:10px;
}

/* سربرگ رسمی */
.header{
  text-align:center;
  border-bottom:3px double #1a5f7a;
  padding-bottom:1.2rem;
  margin-bottom:1.5rem;
}
.header h1{
  margin:0;
  font-size:2rem;
  font-weight:800;
  color:#0f3f52;
  letter-spacing:1px;
}
.header p{
  margin:5px 0;
  font-size:1rem;
  font-weight:500;
}

/* جدول اطلاعات */
table{
  width:100%;
  border-collapse:collapse;
  font-size:1.1rem;
}
th, td{
  border:1px solid #999;
  padding:10px;
}
th{
  background:#1a5f7a;
  color:white;
}
td.label{
  width:35%;
  font-weight:600;
  color:#1a5f7a;
}

/* دکمه پرنت */
.print-btn{
  margin-top:1.5rem;
  background:#2e8b57;
}
.print-btn:hover{background:#256f46;}

.alert{
  color:red;
  text-align:center;
  font-weight:bold;
}

/* مخصوص چاپ */
@media print{
  body{background:white;}
  input, button, .page-title{display:none;}
  .container{margin:0; width:100%;}
  .result{box-shadow:none; border:none;}

  /* چهار رسید در یک A4 */
  .result{
    width:48%;
    display:inline-block;
    vertical-align:top;
    margin:1%;
    page-break-inside:avoid;

    /* خط نقطه‌چین دور رسید برای قیچی */
    border: 1px dashed #999;
    padding:15px;
    border-radius:5px;
  }
}
</style>
</head>

<body>
<div class="container">

  <h2 class="page-title">پیگیری درخواست ویزا</h2>

  <input type="text" id="otpInput" placeholder="کد OTP را وارد کنید">
  <button id="checkBtn">نمایش و آماده‌سازی رسید</button>

  <div class="result" id="resultDiv">

    <!-- سربرگ چاپی -->
    <div class="header">
      <h1>خدمات کمپیوتری سرافرازی</h1>
      <p>شماره تماس: 0705927368 ، 0799846656 ، 0778743678</p>
      <p>آدرس: فاریاب – شهر میمنه</p>
    </div>

    <table id="infoTable"></table>

    <button class="print-btn" onclick="window.print()">پرنت رسید</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCHjDCV5G4SqXBVayBSQKu0w7ahl-iKK9s",
  authDomain: "search-system-d27b7.firebaseapp.com",
  projectId: "search-system-d27b7",
  storageBucket: "search-system-d27b7.firebasestorage.app",
  messagingSenderId: "928320892642",
  appId: "1:928320892642:web:56263d08783990405738bb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const otpInput = document.getElementById('otpInput');
const checkBtn = document.getElementById('checkBtn');
const resultDiv = document.getElementById('resultDiv');
const infoTable = document.getElementById('infoTable');

checkBtn.addEventListener('click', async ()=>{
  const otp = otpInput.value.trim();
  if(!otp){
    alert('کد OTP را وارد کنید');
    return;
  }

  const q = query(collection(db,"visaRequests"), where("otp","==",Number(otp)));
  const snapshot = await getDocs(q);

  resultDiv.style.display = 'block';

  if(snapshot.empty){
    infoTable.innerHTML = `<tr><td class="alert">اطلاعاتی یافت نشد</td></tr>`;
    return;
  }

  snapshot.forEach(docSnap=>{
    const d = docSnap.data();
    infoTable.innerHTML = `
      <tr><th>عنوان</th><th>اطلاعات</th></tr>
      <tr><td class="label">اسم کامل</td><td>${d.fullName}</td></tr>
      <tr><td class="label">اسم پدر</td><td>${d.fatherName}</td></tr>
      <tr><td class="label">نوع ویزا</td><td>${d.visaType}</td></tr>
      <tr><td class="label">وضعیت</td><td>${d.status}</td></tr>
      <tr><td class="label">مبلغ پرداختی</td><td>${d.amount} افغانی</td></tr>
      <tr><td class="label">رسید</td><td>${d.receipt} افغانی</td></tr>
      <tr><td class="label">باقی‌مانده</td><td>${d.remaining} افغانی</td></tr>
      <tr><td class="label">تاریخ تحویل</td><td>${d.deliveryDate}</td></tr>
      <tr><td class="label">کد OTP</td><td>${d.otp}</td></tr>
    `;
  });
});
</script>
</body>
</html>
